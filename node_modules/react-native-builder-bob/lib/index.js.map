{"version":3,"file":"index.js","names":["_path","_interopRequireDefault","require","_fsExtra","_kleur","_dedent","_yargs","_cosmiconfig","_isGitDirty","_prompts","logger","_interopRequireWildcard","_commonjs","_module","_typescript","_getRequireWildcardCache","nodeInterop","WeakMap","cacheBabelInterop","cacheNodeInterop","obj","__esModule","default","cache","has","get","newObj","hasPropertyDescriptor","Object","defineProperty","getOwnPropertyDescriptor","key","prototype","hasOwnProperty","call","desc","set","name","version","root","process","cwd","explorer","cosmiconfigSync","searchPlaces","FLOW_PRGAMA_REGEX","yargs","command","isGitDirty","shouldContinue","prompts","type","message","initial","exit","pak","path","join","fs","pathExists","pkg","JSON","parse","readFile","result","search","config","devDependencies","source","validate","input","Boolean","entryFile","fromEntries","entries","sort","a","b","localeCompare","questions","choices","title","value","selected","test","length","endsWith","push","keys","includes","output","targets","flow","target","undefined","module","types","tsconfig","writeJSON","compilerOptions","rootDir","allowUnreachableCode","allowUnusedLabels","esModuleInterop","forceConsistentCasingInFileNames","jsx","lib","moduleResolution","noFallthroughCasesInSwitch","noImplicitReturns","noImplicitUseStrict","noStrictGenericChecks","noUncheckedIndexedAccess","noUnusedLocals","noUnusedParameters","resolveJsonModule","skipLibCheck","strict","verbatimModuleSyntax","spaces","prepare","files","entry","replace","scripts","stringify","slice","update","filter","file","map","t","copyFlow","jest","modulePathIgnorePatterns","eslintIgnore","ignorefiles","ignorefile","content","split","writeFile","packageManager","console","log","dedent","kleur","yellow","magenta","bold","gray","argv","$0","options","relative","filepath","exclude","report","info","warn","error","success","targetName","Array","isArray","targetOptions","blue","buildCommonJS","resolve","buildModule","buildTypescript","demandCommand","recommendCommands"],"sources":["../src/index.ts"],"sourcesContent":["import path from 'path';\nimport fs from 'fs-extra';\nimport kleur from 'kleur';\nimport dedent from 'dedent';\nimport yargs from 'yargs';\nimport { cosmiconfigSync } from 'cosmiconfig';\nimport isGitDirty from 'is-git-dirty';\nimport prompts, { type PromptObject } from './utils/prompts';\nimport * as logger from './utils/logger';\nimport buildCommonJS from './targets/commonjs';\nimport buildModule from './targets/module';\nimport buildTypescript from './targets/typescript';\nimport type { Options } from './types';\n\n// eslint-disable-next-line import/no-commonjs, @typescript-eslint/no-var-requires\nconst { name, version } = require('../package.json');\n\nconst root = process.cwd();\nconst explorer = cosmiconfigSync(name, {\n  searchPlaces: ['package.json', `bob.config.js`, 'bob.config.cjs'],\n});\n\nconst FLOW_PRGAMA_REGEX = /\\*?\\s*@(flow)\\b/m;\n\nyargs\n  .command('init', 'configure the package to use bob', {}, async () => {\n    if (isGitDirty()) {\n      const { shouldContinue } = await prompts({\n        type: 'confirm',\n        name: 'shouldContinue',\n        message: `The working directory is not clean. You should commit or stash your changes before configuring bob. Continue anyway?`,\n        initial: false,\n      });\n\n      if (!shouldContinue) {\n        process.exit(0);\n      }\n    }\n\n    const pak = path.join(root, 'package.json');\n\n    if (!(await fs.pathExists(pak))) {\n      logger.exit(\n        `Couldn't find a 'package.json' file in '${root}'. Are you in a project folder?`\n      );\n    }\n\n    const pkg = JSON.parse(await fs.readFile(pak, 'utf-8'));\n    const result = explorer.search();\n\n    if (result?.config && pkg.devDependencies && name in pkg.devDependencies) {\n      const { shouldContinue } = await prompts({\n        type: 'confirm',\n        name: 'shouldContinue',\n        message: `The project seems to be already configured with bob. Do you want to overwrite the existing configuration?`,\n        initial: false,\n      });\n\n      if (!shouldContinue) {\n        process.exit(0);\n      }\n    }\n\n    const { source } = await prompts({\n      type: 'text',\n      name: 'source',\n      message: 'Where are your source files?',\n      initial: 'src',\n      validate: (input) => Boolean(input),\n    });\n\n    let entryFile;\n\n    if (await fs.pathExists(path.join(root, source, 'index.js'))) {\n      entryFile = 'index.js';\n    } else if (await fs.pathExists(path.join(root, source, 'index.ts'))) {\n      entryFile = 'index.ts';\n    } else if (await fs.pathExists(path.join(root, source, 'index.tsx'))) {\n      entryFile = 'index.tsx';\n    }\n\n    if (!entryFile) {\n      logger.exit(\n        `Couldn't find a 'index.js'. 'index.ts' or 'index.tsx' file under '${source}'. Please re-run the CLI after creating it.`\n      );\n      return;\n    }\n\n    pkg.devDependencies = Object.fromEntries(\n      [\n        ...Object.entries(pkg.devDependencies || {}),\n        [name, `^${version}`],\n      ].sort(([a], [b]) => a.localeCompare(b))\n    );\n\n    const questions: PromptObject[] = [\n      {\n        type: 'text',\n        name: 'output',\n        message: 'Where do you want to generate the output files?',\n        initial: 'lib',\n        validate: (input: string) => Boolean(input),\n      },\n      {\n        type: 'multiselect',\n        name: 'targets',\n        message: 'Which targets do you want to build?',\n        choices: [\n          {\n            title: 'commonjs - for running in Node (tests, SSR etc.)',\n            value: 'commonjs',\n            selected: true,\n          },\n          {\n            title: 'module - for bundlers (metro, webpack etc.)',\n            value: 'module',\n            selected: true,\n          },\n          {\n            title: 'typescript - declaration files for typechecking',\n            value: 'typescript',\n            selected: /\\.tsx?$/.test(entryFile),\n          },\n        ],\n        validate: (input: string) => Boolean(input.length),\n      },\n    ];\n\n    if (\n      entryFile.endsWith('.js') &&\n      FLOW_PRGAMA_REGEX.test(\n        await fs.readFile(path.join(root, source, entryFile), 'utf-8')\n      )\n    ) {\n      questions.push({\n        type: 'confirm',\n        name: 'flow',\n        message: 'Do you want to publish definitions for flow?',\n        initial: Object.keys(pkg.devDependencies || {}).includes('flow-bin'),\n      });\n    }\n\n    const { output, targets, flow } = await prompts(questions);\n\n    const target =\n      targets[0] === 'commonjs' || targets[0] === 'module'\n        ? targets[0]\n        : undefined;\n\n    const entries: { [key: string]: string } = {\n      'main': target\n        ? path.join(output, target, 'index.js')\n        : path.join(source, entryFile),\n      'react-native': path.join(source, entryFile),\n      'source': path.join(source, entryFile),\n    };\n\n    if (targets.includes('module')) {\n      entries.module = path.join(output, 'module', 'index.js');\n    }\n\n    if (targets.includes('typescript')) {\n      entries.types = path.join(output, 'typescript', source, 'index.d.ts');\n\n      if (!(await fs.pathExists(path.join(root, 'tsconfig.json')))) {\n        const { tsconfig } = await prompts({\n          type: 'confirm',\n          name: 'tsconfig',\n          message: `You have enabled 'typescript' compilation, but we couldn't find a 'tsconfig.json' in project root. Generate one?`,\n          initial: true,\n        });\n\n        if (tsconfig) {\n          await fs.writeJSON(\n            path.join(root, 'tsconfig.json'),\n            {\n              compilerOptions: {\n                rootDir: '.',\n                allowUnreachableCode: false,\n                allowUnusedLabels: false,\n                esModuleInterop: true,\n                forceConsistentCasingInFileNames: true,\n                jsx: 'react',\n                lib: ['esnext'],\n                module: 'esnext',\n                moduleResolution: 'node',\n                noFallthroughCasesInSwitch: true,\n                noImplicitReturns: true,\n                noImplicitUseStrict: false,\n                noStrictGenericChecks: false,\n                noUncheckedIndexedAccess: true,\n                noUnusedLocals: true,\n                noUnusedParameters: true,\n                resolveJsonModule: true,\n                skipLibCheck: true,\n                strict: true,\n                target: 'esnext',\n                verbatimModuleSyntax: true,\n              },\n            },\n            { spaces: 2 }\n          );\n        }\n      }\n    }\n\n    const prepare = 'bob build';\n    const files = [\n      source,\n      output,\n      '!**/__tests__',\n      '!**/__fixtures__',\n      '!**/__mocks__',\n    ];\n\n    for (const key in entries) {\n      const entry = entries[key];\n\n      if (pkg[key] && pkg[key] !== entry) {\n        const { replace } = await prompts({\n          type: 'confirm',\n          name: 'replace',\n          message: `Your package.json has the '${key}' field set to '${pkg[key]}'. Do you want to replace it with '${entry}'?`,\n          initial: true,\n        });\n\n        if (replace) {\n          pkg[key] = entry;\n        }\n      } else {\n        pkg[key] = entry;\n      }\n    }\n\n    if (pkg.scripts?.prepare && pkg.scripts.prepare !== prepare) {\n      const { replace } = await prompts({\n        type: 'confirm',\n        name: 'replace',\n        message: `Your package.json has the 'scripts.prepare' field set to '${pkg.scripts.prepare}'. Do you want to replace it with '${prepare}'?`,\n        initial: true,\n      });\n\n      if (replace) {\n        pkg.scripts.prepare = prepare;\n      }\n    } else {\n      pkg.scripts = pkg.scripts || {};\n      pkg.scripts.prepare = prepare;\n    }\n\n    if (\n      pkg.files &&\n      JSON.stringify(pkg.files.slice().sort()) !==\n        JSON.stringify(files.slice().sort())\n    ) {\n      const { update } = await prompts({\n        type: 'confirm',\n        name: 'update',\n        message: `Your package.json already has a 'files' field. Do you want to update it?`,\n        initial: true,\n      });\n\n      if (update) {\n        pkg.files = [\n          ...files,\n          ...pkg.files.filter(\n            (file: string) => !files.includes(file.replace(/\\/$/g, ''))\n          ),\n        ];\n      }\n    } else {\n      pkg.files = files;\n    }\n\n    pkg[name] = {\n      source,\n      output,\n      targets: targets.map((t: string) => {\n        if (t === target && flow) {\n          return [t, { copyFlow: true }];\n        }\n\n        return t;\n      }),\n    };\n\n    if (pkg.jest) {\n      const entry = `<rootDir>/${output}/`;\n\n      if (pkg.jest.modulePathIgnorePatterns) {\n        const { modulePathIgnorePatterns } = pkg.jest;\n\n        if (!modulePathIgnorePatterns.includes(entry)) {\n          modulePathIgnorePatterns.push(entry);\n        }\n      } else {\n        pkg.jest.modulePathIgnorePatterns = [entry];\n      }\n    }\n\n    pkg.eslintIgnore = pkg.eslintIgnore || ['node_modules/'];\n\n    if (!pkg.eslintIgnore.includes(`${output}/`)) {\n      pkg.eslintIgnore.push(`${output}/`);\n    }\n\n    await fs.writeJSON(pak, pkg, {\n      spaces: 2,\n    });\n\n    const ignorefiles = [\n      path.join(root, '.gitignore'),\n      path.join(root, '.eslintignore'),\n    ];\n\n    for (const ignorefile of ignorefiles) {\n      if (await fs.pathExists(ignorefile)) {\n        const content = await fs.readFile(ignorefile, 'utf-8');\n\n        if (!content.split('\\n').includes(`${output}/`)) {\n          await fs.writeFile(\n            ignorefile,\n            `${content}\\n# generated by bob\\n${output}/\\n`\n          );\n        }\n      }\n    }\n\n    const packageManager = (await fs.pathExists(path.join(root, 'yarn.lock')))\n      ? 'yarn'\n      : 'npm';\n\n    console.log(\n      dedent(`\n      Project ${kleur.yellow(pkg.name)} configured successfully!\n\n      ${kleur.magenta(\n        `${kleur.bold('Perform last steps')} by running`\n      )}${kleur.gray(':')}\n\n        ${kleur.gray('$')} ${packageManager} install\n\n      ${kleur.yellow('Good luck!')}\n    `)\n    );\n  })\n  .command('build', 'build files for publishing', {}, async (argv) => {\n    const result = explorer.search();\n\n    if (!result?.config) {\n      logger.exit(\n        `No configuration found. Run '${argv.$0} init' to create one automatically.`\n      );\n    }\n\n    const options: Options = result!.config;\n\n    if (!options.targets?.length) {\n      logger.exit(\n        `No targets found in the configuration in '${path.relative(\n          root,\n          result!.filepath\n        )}'.`\n      );\n    }\n\n    const source = options.source;\n\n    if (!source) {\n      logger.exit(\n        `No source option found in the configuration in '${path.relative(\n          root,\n          result!.filepath\n        )}'.`\n      );\n    }\n\n    const output = options.output;\n\n    if (!output) {\n      logger.exit(\n        `No source option found in the configuration in '${path.relative(\n          root,\n          result!.filepath\n        )}'.`\n      );\n    }\n\n    const exclude =\n      options.exclude ?? '**/{__tests__,__fixtures__,__mocks__}/**';\n\n    const report = {\n      info: logger.info,\n      warn: logger.warn,\n      error: logger.error,\n      success: logger.success,\n    };\n\n    for (const target of options.targets!) {\n      const targetName = Array.isArray(target) ? target[0] : target;\n      const targetOptions = Array.isArray(target) ? target[1] : undefined;\n\n      report.info(`Building target ${kleur.blue(targetName)}`);\n\n      switch (targetName) {\n        case 'commonjs':\n          await buildCommonJS({\n            root,\n            source: path.resolve(root, source as string),\n            output: path.resolve(root, output as string, 'commonjs'),\n            exclude,\n            options: targetOptions,\n            report,\n          });\n          break;\n        case 'module':\n          await buildModule({\n            root,\n            source: path.resolve(root, source as string),\n            output: path.resolve(root, output as string, 'module'),\n            exclude,\n            options: targetOptions,\n            report,\n          });\n          break;\n        case 'typescript':\n          await buildTypescript({\n            root,\n            source: path.resolve(root, source as string),\n            output: path.resolve(root, output as string, 'typescript'),\n            options: targetOptions,\n            report,\n          });\n          break;\n        default:\n          logger.exit(`Invalid target ${kleur.blue(targetName)}.`);\n      }\n    }\n  })\n  .demandCommand()\n  .recommendCommands()\n  .strict().argv;\n"],"mappings":"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"}